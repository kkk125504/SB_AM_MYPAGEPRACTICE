### NeedLoginInterceptor가 각 액션이 실행되기 전 로그인 체크를 앞단에서 실행

**1\)  Rq클래스의 메소드(printHistoryBackJs,print)**

```java
  	public void printHistoryBackJs(String msg) {
		resp.setContentType("text/html; charset=UTF-8");
        print("<script>");
		if (msg.length() != 0) {
			print("alert('" + msg + "');");
		}
		print("history.back();");
		print("</script>");
	}

	public void print(String msg) {
		try {
			resp.getWriter().append(msg);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
    public void println(String str) {
		print(str + "\n");
	}    
```

- resp.getWriter().append()으로 요청에 대한 응답을 해줄수있지만 ```history.back()```를 메소드를 통해 여러곳에서 활용하기 위함
- print() 메소드는 내부적으로 resp.getWriter().append();를 이용해 요청에 대한 응답을 추가

**2\) 각 액션이 실행되기 전 로그인 체크를 앞단에서 실행 **

```java
	if (rq.isLogined() == false) {
			return Ut.jsHistoryBack("로그인 후 이용해주세요");
		}
```

- 위의 코드는 컨트롤러에서 로그인 관련 체크를 하는 코드로 ```컨트롤러 실행 전``` 수행하기 위해 NeedLoginInterceptor 구현

```java
    public class NeedLoginInterceptor implements HandlerInterceptor {
        @Override
        public boolean preHandle(HttpServletRequest req, HttpServletResponse resp, Object handler) throws Exception {
            Rq rq = (Rq)req.getAttribute("rq");		
            if(!rq.isLogined()) {
                rq.printHistoryBackJs("로그인 후 이용 가능합니다.");
                return false;
            }
            return HandlerInterceptor.super.preHandle(req, resp, handler);
        }
```

- 컨트롤러가 실행되기 이전에 ```NeedLoginInterceptor```를 통해 로그인 체크
- Rq rq = (Rq)req.getAttribute("rq"); 는 ```NeedLoginInterceptor``` 실행되기 이전에 
- ```BeforeActionInterceptor``` 에서``` req.setAttribute("rq", rq)```했기 때문에 새로 ```new```하지않아도 됨
- preHandle메소드는 ```컨트롤러 실행 전``` 수행한다. 반환 값이 ```true```일 경우 컨트롤러로 진입하고 ```false```일 경우 진입하지 않는다.
- 만약 로그인이 되있지 않다면, ```printHistoryBackJs()``` 메소드를 통해 요청에대한 응답을 한다.

