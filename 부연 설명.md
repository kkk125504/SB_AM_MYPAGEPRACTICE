 ### 댓글 삭제 구현

**1\) ReplyController**

```java
	@RequestMapping("/usr/reply/doDelete")
	@ResponseBody
	public String doDelete(int id, String replaceUri) {

		if (Ut.empty(id)) {
			return rq.jsHistoryBack("id가 없습니다");
		}

		Reply reply = replyService.getForPrintReply(rq.getLoginedMember(), id);

		if (reply == null) {
			return rq.jsHistoryBack(Ut.f("%d번 댓글은 존재하지 않습니다", id));
		}

		if (reply.isExtra__actorCanDelete() == false) {
			return rq.jsHistoryBack("해당 댓글을 삭제할 권한이 없습니다");
		}

		ResultData deleteReplyRd = replyService.deleteReply(id);

		if (Ut.empty(replaceUri)) {
			switch (reply.getRelTypeCode()) {
			case "article":
				replaceUri = Ut.f("../article/detail?id=%d", reply.getRelId());
				break;
			}
		}
		return rq.jsReplace(deleteReplyRd.getMsg(), replaceUri);
	}
```

- 삭제버튼 클릭시 위의 메서드가 실행이 되는데
- ```replyService.getForPrintReply(rq.getLoginedMember(), id)``` 메서드로 id에 해당하는 댓글을 가져옴
- 댓글의 존재여부, 삭제권한 체크하고 조건이 맞지 않을시 뒤로 돌아가기
- ```replyService.deleteReply(id)``` : 실질적으로 댓글을 삭제하는 메서드

**2\) ReplyRepository**

```java
	@Select("""
			<script>
				SELECT R.*,
				M.nickname AS extra__writerName
				FROM reply AS R
				LEFT JOIN `member` AS M
				ON R.memberId = M.id
				WHERE R.id = #{id}
			</script>
			""")
	Reply getForPrintReply(int id);

	@Delete("""
			DELETE FROM reply
			WHERE id = #{id}
			""")
	void deleteReply(int id);
```

- 첫번째 쿼리문은 id에 해당하는 댓글을 가져오는 쿼리문
- 두번째 쿼리문은 id에 해당하는 댓글을 삭제하는 쿼리문