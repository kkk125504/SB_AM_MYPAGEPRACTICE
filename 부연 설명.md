 ### 댓글삭제와 수정버튼 노출

**1\) 댓글 리스트에 수정/삭제 권한 데이터 업데이트**

```java
	public List<Reply> getForPrintReplies(Member actor, String relTypeCode, int relId) {
		List<Reply> replies = replyRepository.getForPrintReplies(relTypeCode, relId);

		for (Reply reply : replies) {
			updateForPrintData(actor, reply);
		}

		return replies;
	}	
```

- 게시물의 수정/삭제 권한 데이터를 게시물 객체에 직접 업데이트 했던 것처럼
- DB로부터 댓글을 List로 가져온 후
- 댓글에 대한 수정/삭제 권한을 ```updateForPrintData(actor, reply)```를 통해 댓글 객체에 업데이트

**2\) 댓글에 수정/삭제 권한 업데이트 메소드**

```java
	private void updateForPrintData(Member actor, Reply reply) {
		if (actor == null) {
			return;
		}

		ResultData actorCanDeleteRd = actorCanDelete(actor, reply);
		reply.setExtra__actorCanDelete(actorCanDeleteRd.isSuccess());

		ResultData actorCanModifyRd = actorCanModify(actor, reply);
		reply.setExtra__actorCanModify(actorCanModifyRd.isSuccess());
	}
```

- 댓글객체에 수정/삭제 권한에대한 데이터를 추가

**3\) 댓글에 수정/삭제 권한여부 체크**

```java
	private ResultData actorCanModify(Member actor, Reply reply) {
		if (reply == null) {
			return ResultData.from("F-1", "댓글이 존재하지 않습니다");
		}

		if (reply.getMemberId() != actor.getId()) {
			return ResultData.from("F-2", "해당 게시물에 대한 권한이 없습니다");
		}

		return ResultData.from("S-1", "수정 가능");
	}

	private ResultData actorCanDelete(Member actor, Reply reply) {
		if (reply == null) {
			return ResultData.from("F-1", "댓글이 존재하지 않습니다");
		}

		if (reply.getMemberId() != actor.getId()) {
			return ResultData.from("F-2", "해당 게시물에 대한 권한이 없습니다");
		}

		return ResultData.from("S-1", "삭제 가능");
	}
```

- 매개변수로 받는 actor는 로그인된 멤버이다.
- 로그인된 멤버아이디와 댓글에 저장되있는 멤버아이디가 같다면 수정/삭제 권한 true

**4\) 게시물 상세보기 jsp** 

```jsp
    <td>
        <c:if test="${reply.extra__actorCanModify }">
            <a class="btn btn-ghost" href="../reply/modify?id=${reply.id }">수정</a>
        </c:if>
        <c:if test="${reply.extra__actorCanDelete }">
            <a class="btn btn-ghost" onclick="if(confirm('삭제 하시겠습니까?') == false) return false;"
               href="../reply/doDelete?id=${reply.id }"
               >삭제</a>
        </c:if>
    </td>
```

- 댓글 리스트를 테이블로 보여주고 있어 테이블에 수정/삭제 버튼을 추가
- 위에 코드에서 로그인된 회원이 해당 댓글에 수정/삭제를 할수있는지 체크 했기때문에
- 권한여부에따라 수정/삭제버튼 을 노출시킴 